{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="my-4">Payment for {{ booking.service_type|title }} Service</h2>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5>Booking Details:</h5>
            <p>Service: {{ booking.service_type|title }}</p>
            <p>Car: {{ booking.car_details }}</p>
            <p>Total Amount: KSH {{ "%.2f"|format(booking.total_amount) }}</p>
            <p>Amount Paid: KSH {{ "%.2f"|format(booking.amount_paid) }}</p>
            <p class="fw-bold">Remaining Balance: KSH {{ "%.2f"|format(booking.total_amount - booking.amount_paid) }}</p>
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5>Make Payment</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('payment') }}">
                <div class="mb-3">
                    <label class="form-label">Payment Type</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payment_type" id="fullPayment" value="full" {% if booking.amount_paid == 0 %}checked{% endif %}>
                        <label class="form-check-label" for="fullPayment">
                            Full Payment (KSH {{ "%.2f"|format(booking.total_amount) }})
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payment_type" id="depositPayment" value="deposit" {% if booking.amount_paid > 0 %}checked{% endif %}>
                        <label class="form-check-label" for="depositPayment">
                            Deposit (Minimum KSH {{ "%.2f"|format(booking.total_amount * 0.2) }})
                        </label>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="amount" class="form-label">Amount to Pay</label>
                    <input type="number" class="form-control" id="amount" name="amount" 
                           min="{% if booking.amount_paid == 0 %}{{ booking.total_amount * 0.2 }}{% else %}{{ booking.total_amount - booking.amount_paid }}{% endif %}" 
                           max="{{ booking.total_amount }}" 
                           value="{% if booking.amount_paid == 0 %}{{ booking.total_amount }}{% else %}{{ booking.total_amount - booking.amount_paid }}{% endif %}" 
                           step="0.01" required>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">Pay via M-Pesa</button>
            </form>
        </div>
    </div>
</div>

{% endblock %}